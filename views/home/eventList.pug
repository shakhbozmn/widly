include ../head.pug
body
  .wd-events-list  
    .container.mt-5
      .row.mb-5
        .wd-header-btn-group
          .wd-header 
            .back-icon 
              a(href="/") 
                i.fas.fa-chevron-left
            h1.wd-title Events List
          a.btn.btn-success.wd-btn-top(href='/add', role='button') Add New Event

      .row#eventsRow

script.
  document.addEventListener('DOMContentLoaded', function() {
    axios.get('/api/event').then(function(response) {
      const events = response.data;
      const eventsRow = document.querySelector('#eventsRow');
      events.forEach(e => {
        const col = document.createElement('div');
        col.className = 'col-md-4 mb-4';
        const event = e.event;
        col.innerHTML = `
          <div class="card text-white bg-dark h-100">
            <div class="card-header">Event ID: ${e.id}</div>
            <div class="card-body">
              <h5 class="card-title">${event.eventName}</h5>
              <p class="card-text"><span>Date & Time:</span> ${event.eventDateTime}</p>
              <p class="card-text"><span>Venue:</span> ${event.venue}</p>
              <p class="card-text"><span>Contact:</span> ${event.contactPhone}</p>
              <p class="card-text"><span>Seat:</span> ${event.seat}</p>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary btn-sm" onclick="window.location.href='/update/${e.id}'">Update</button>
              <button class="btn btn-danger btn-sm" data-id="${e.id}">Delete</button>
            </div>
          </div>
        `;
        eventsRow.appendChild(col);
      });
    })
    .catch(function(error) {
      console.log(error);
    });

    // Use event delegation for delete buttons
    document.addEventListener('click', function(event) {
      if (event.target && event.target.classList.contains('btn-danger')) {
        const eventId = event.target.getAttribute('data-id');
        axios.delete(`/api/event/${eventId}`).then(function(response) {
          alert('Deleted successfully');
          location.reload();
        })
        .catch(function(error) {
          alert('Error deleting event: ' + error);
        });
      }
    });
  });
